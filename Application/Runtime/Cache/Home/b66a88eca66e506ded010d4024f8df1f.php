<?php if (!defined('THINK_PATH')) exit(); $string = '+-'; $tmp = str_shuffle($string); $str = substr($tmp,1); $str1 = rand(10,99); $str2 = rand(10,99); $fontSize = 10; $length = 6; $width = 66; $height = 18; $strNum = "$str1".$str."$str2".'='; setcookie('code',$strNum); $im = imagecreate($width,$height); $backgroundcolor = imagecolorallocate ($im, 255, 255, 255); $frameColor = imageColorAllocate($im, 150, 150, 150); $font = '/Public/Home/include/arial.TTF'; for($i = 0; $i < $length; $i++) { $charY = 15; $charX = $i*9+8; $text_color = imagecolorallocate($im, mt_rand(50, 200), mt_rand(50, 128), mt_rand(50, 200)); $angle = 0; imageTTFText($im, $fontSize, $angle, $charX, $charY, $text_color, $font, $strNum[$i]); } for($i=0; $i <= 5; $i++) { $linecolor = imagecolorallocate($im, mt_rand(0, 255), mt_rand(0, 255), mt_rand(0, 255)); $linex = mt_rand(1, $width-1); $liney = mt_rand(1, $height-1); imageline($im, $linex, $liney, $linex + mt_rand(0, 14) - 2, $liney + mt_rand(0, 14) - 2, $linecolor); } for($i=0; $i <= 50; $i++) { $pointcolor = imagecolorallocate($im, mt_rand(0, 255), mt_rand(0, 255), mt_rand(0, 255)); imagesetpixel($im, mt_rand(1, $width-1), mt_rand(1, $height-1), $pointcolor); } imagerectangle($im, 0, 0, $width-1 , $height-1 , $frameColor); header('Content-type: image/png'); imagepng($im); imagedestroy($im); ?>